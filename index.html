<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="UTF-8">
	<title>Jonathan Bown, jonvzw6@gmail.com, U0696785</title>
	<head>
  <link rel="stylesheet" href="tubeMap.css">
  <script src="https://d3js.org/d3.v4.js"></script>
	<script src=d3-tube-map/d3-tube-map.js></script>
	<script src=script.js></script>
  <link href='https://fonts.googleapis.com/css?family=Hammersmith+One' rel='stylesheet' type='text/css'>

</head>
<img src="https://vignette.wikia.nocookie.net/logopedia/images/3/3a/London_Underground_1970_roundel_small.png/revision/latest?cb=20120209090410" style="float: right; width: 100px; height: 80px" />
<nav>
  <ul>
    <li><a href="map.html">Google Map</a></li>
      <li><a href="video.html">Video</a></li>
	</ul>

</nav>
<body>

	<div id="floating-panel1" style ="margin-left:30px;  margin-bottom:10px;">
		<h2 style = "text-align: center">London Underground</h2>
		Select Both/Entry/Exit:
	<select id = "data-year" onchange="callback();">
<option value="null"> -- select an option -- </option>
<option value="both">Both</option>
<option value="entry">Entry</option>
<option value="exit">Exit</option>
<!-- <option value="2009">2009</option>
<option value="2010">2010</option> -->
</select>

<button onclick = "startTimeAnimation()">A Day on the Tube</button>

<text id="clock" style="text-align: center; float: right"></text>
<text id ="journey" style="text-align: center; float: right"></text>

</div>



  <div id="tube-map" style ="margin-left:30px; height: 1024px">
  </div>
  <script>
	/*  <script src="https://unpkg.com/d3-tube-map@latest/build/d3-tube-map.js"></scr>  */
    var el = document.getElementById('tube-map');
		var width = 1600;
		var height = 1024;

    var svg = d3.select(el)
        .append('svg')
        .style('width', "100%")
        .style('height', "100%").attr("id", "container");



    const map = tubeMap.tubeMap()
      .width(width)
      .height(height)
      .margin({
        top: height / 50,
        right: width / 7,
        bottom: height / 10,
        left: width / 7,
      });

    d3.json("stations.json", function(error, data) {
			if(error != null){
				console.log("something went wrong");
			}
      svg.datum(data).call(map);
    });


		function startTimeAnimation(){
			//Change aesthetics so that the visualization looks Good

			//start a timer

			//map.highlightLine("Metropolitan");

			d3.json("stations.json", function(error, data) {
				if(error != null){
					console.log("something went wrong");
				}




			d3.csv("tubedata/RODS_2016/Misc/Stationflows/AEI-Summary.csv", function(error, csvData){

				var timeTable = [];
						var myDate = new Date();
						let stripMilliseconds_all = function(s) { return s.slice(0, -1); };
									var format_entry = d3.timeFormat("%H:%M");
				//The clock starts at 5 am
				for(var i = 5; i <= 24; i++){
					if(i === 24){
						for(var j = 0; j < 5; j++){
						for(var min = 0; min < 60; min++){
							myDate.setHours(j, min, 0, 0);
							time_stamp = format_entry(myDate);
							timeTable.push(time_stamp);
						}
					}

					}
					else{



					for(var min = 0; min < 60; min++){
						myDate.setHours(i, min, 0, 0);
						time_stamp = format_entry(myDate);
						timeTable.push(time_stamp);
					}
				}

				}



				// var filteredCsvData = csvData.filter(function(d){
				//
				//
				// 	//Here we initially filter the data to give to the map
				//
				// 	return d.StartStn !== "Unstarted";
				// })

				//console.log(csvData);

				//map.createSructure(filteredCsvData);

				map.startTimer(csvData, timeTable, data);


			});

			});

			//select the data that meets the timer


		}


  </script>

</body>
<script>



</script>

</html>
